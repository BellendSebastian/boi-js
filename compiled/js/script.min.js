define("Loader",[],function(){function e(){this.assets=[],this.queue=[],this.queued=0,this.completed=0,this.error=0}return e.prototype.add=function(e){return this.queue[e]=null,this.queued+=1,this},e.prototype.loadAll=function(){var e=this;for(var t in this.queue)if(t.indexOf("sprite")!==-1||t.indexOf("tiles")!==-1){var n=new Image;n.src="."+t,this.assets[t]=n,n.addEventListener("load",e.addComplete.bind(e),!1),n.addEventListener("error",e.addError.bind(e),!1)}},e.prototype.addComplete=function(){this.completed+=1},e.prototype.addError=function(){this.error+=1},e.prototype.checkLoaded=function(){return this.queued===this.completed+this.error},e}),define("Renderer",[],function(){function e(e,t,n){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.screen=null,this.subscreen=null,this.inSubscreen=!1,this.showFps=!0,this.lastStep=(new Date).getTime(),this.fps="--",this.frameCount=0,this.canvas.width=t,this.canvas.height=n,this.clear()}return e.prototype.useScreen=function(e){return this.screen=e,this},e.prototype.clear=function(){this.canvas.width=this.canvas.width,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.update=function(){this.inSubscreen?this.subscreen.update():this.screen.update()},e.prototype.draw=function(){this.clear(),this.inSubscreen?this.subscreen.draw(this.canvas,this.ctx):this.screen.draw(this.canvas,this.ctx),this.fpsCounter()},e.prototype.useSubscreen=function(e){this.subscreen=e,this.inSubscreen=!0},e.prototype.clearSubscreen=function(){this.inSubscreen=!1,this.subscreen=null},e.prototype.pause=function(){this.clear(),this.ctx.textAlign="center",this.ctx.fillStyle="#fff",this.ctx.fillText("Paused.",this.canvas.width/2,this.canvas.height/2),this.ctx.fillText("Press [ESC] to continue.",this.canvas.width/2,this.canvas.height/2+10)},e.prototype.fpsCounter=function(){this.frameCount++;var e=(new Date).getTime(),t=e-this.lastStep;t>=1e3&&(this.fps=this.frameCount,this.frameCount=0,t-=1e3,this.lastStep=e),this.ctx.textAlign="left",this.ctx.fillStyle="#fff",this.ctx.fillText(this.fps,10,20)},e}),define("Creature",[],function(){function e(e){this.player=!1,this.hp=0,this.speed=3,this.rof=3,this.fireCooldown=0,this.hasFired=!1,this.damage=1,this.sprite=e,this.width=16,this.height=16,this.pos={x:0,y:0}}return e.prototype.update=function(){return this.hasFired&&this.fireCooldown++,this.fireCooldown>=(15-this.rof)*2&&(this.hasFired=!1,this.fireCooldown=0),this},e.prototype.draw=function(e){return e.ctx.drawImage(this.sprite,this.pos.x-this.width/2,this.pos.y-this.height/2),this},e.prototype.move=function(e,t){return this.pos.x+=e*this.speed,this.pos.y+=t*this.speed,this},e.prototype.getPos=function(){return this.pos},e.prototype.setPos=function(e){return this.pos=e,this},e.prototype.setPlayer=function(e){return this.player=e,this},e.prototype.isPlayer=function(){return this.player},e.prototype.getHp=function(){return this.hp},e.prototype.modHp=function(e){return this.hp+=e,this},e.prototype.setDamage=function(e){return this.damage=e,this},e.prototype.getDamage=function(){return this.damage},e.prototype.checkCollisions=function(e,t){},e}),define("Player",["Creature"],function(e){function t(t){e.call(this),this.sprite=t}return t.prototype=new e,t.prototype.constructor=t,t}),define("CreatureFactory",["Player"],function(e){function t(){}return t.prototype.spawnPlayer=function(t){var n=new e(t);return n.setPlayer(!0),n.setDamage(8),n.modHp(3),n.setPos({x:50,y:50}),n},t}),define("BaseEntity",[],function(){function e(e,t,n){this.sprite=e,this.size=64,this.pos={x:t,y:n}}return e.prototype.update=function(){},e.prototype.draw=function(e){e.ctx.drawImage(this.sprite,this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size)},e}),define("Projectile",["BaseEntity"],function(e){function t(t,n,r,i,s,o){this.speed=10,this.modifier=o,this.damage=0,this.vel={x:i*this.speed+this.modifier.x*2,y:s*this.speed+this.modifier.y*2},e.call(this,t,n,r),this.size=32}return t.prototype=new e,t.prototype.constructor=t,t.prototype.modDamage=function(e){return this.damage+=e,this},t.prototype.update=function(){return this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this},t.prototype.checkCollisions=function(e,t){},t}),define("Poop",["BaseEntity"],function(e){function t(t,n,r){e.call(this,t,n,r)}return t.prototype=new e,t.prototype.constructor=t,t}),define("Fire",["BaseEntity"],function(e){function t(t,n,r){e.call(this,t,n,r)}return t.prototype=new e,t.prototype.constructor=t,t}),define("EntityFactory",["Projectile","Poop","Fire"],function(e,t,n){function r(){}return r.prototype.spawnPoop=function(e,n,r){var i=new t(e,n,r);return i},r.prototype.spawnFire=function(e,t,r){var i=new n(e,t,r);return i},r.prototype.spawnProjectile=function(t,n,r,i,s,o){var u=new e(t,n,r,i,s,o);return u},r}),define("Input",[],function(){function e(){this.pressedKeys=[],this.keydown=function(e){this.pressedKeys[e.keyCode]=!0},this.keyup=function(e){this.pressedKeys[e.keyCode]=!1},document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this))}return e.prototype.isPressed=function(e){return this.pressedKeys[e]?!0:!1},e}),define("Screen",[],function(){function e(){this.title=null}return e.prototype.update=function(){return this},e.prototype.draw=function(e,t){return this},e}),define("ScreenMain",["Screen"],function(e){function t(){e.call(this),this.title="Main"}return t.prototype=new e,t.prototype.constructor=t,t}),define("MainMenu",["Screen"],function(e){function t(){e.call(this),this.title="Ingame Menu"}return t.prototype=new e,t.prototype.constructor=t,t.prototype.draw=function(e,t){t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.rect(20,40,e.width-40,e.height-60),t.stroke(),t.fillStyle="#fff",t.textAlign="center",t.fillText("-- "+this.title+" --",e.width/2,20),t.textAlign="right",t.fillText("[ESC] to return to game.",e.width-40,e.height-40)},t}),define("Room",[],function(){function e(e,t){this.tileSize=64,this.tileSet=e,this.layout=t}return e.prototype.getLayout=function(){return this.layout},e.prototype.draw=function(e){for(var t=0;t<this.layout.length;t++)for(var n=0;n<this.layout[0].length;n++)this.layout[t][n]===1||this.layout[t][n]===0?e.drawImage(this.tileSet,this.layout[t][n]*this.tileSize,0,this.tileSize,this.tileSize,this.tileSize*n+this.tileSize,this.tileSize*t+this.tileSize*2,this.tileSize,this.tileSize):e.drawImage(this.tileSet,0*this.tileSize,0,this.tileSize,this.tileSize,this.tileSize*n+this.tileSize,this.tileSize*t+this.tileSize*2,this.tileSize,this.tileSize);return this},e}),define("RoomLayouts",[],function(){function e(){return this.layouts=[[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,1,1,1,0,0,0,0,0,1,1,1,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],[[4,0,0,0,0,0,0,0,0,0,0,0,4],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,0,0,0,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[4,0,0,0,0,0,0,0,0,0,0,0,4]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,0,0],[0,1,0,0,3,0,3,0,3,0,0,1,0],[0,0,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,1,0,0,0,0,1,0,0,0,0,1,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]]],this}return e.prototype.getRandomLayout=function(){return this.layouts[Math.floor(Math.random()*this.layouts.length)]},e}),define("Floor",["Room","RoomLayouts"],function(e,t){function n(n,r){this.tileSet=n,this.depth=r,this.roomCount=5,this.rooms=[];var i=new t;for(var s=0;s<this.roomCount;s++)this.rooms.push(new e(this.tileSet,i.getRandomLayout()))}return n}),define("World",["Floor"],function(e){function t(e){this.tileSet=e[0],this.floors=[],this.room=null,this.floor=null,this.floorCount=0}return t.prototype.getFloor=function(){return this.floor},t.prototype.getRoom=function(){return this.room},t.prototype.setFloors=function(e){return this.floorCount=e,this},t.prototype.build=function(){for(var t=0;t<this.floorCount;t++)this.floors.push(new e(this.tileSet,t));return this.floor=this.floors[0],this.room=this.floor.rooms[0],this},t}),define("WorldFactory",["World"],function(e){function t(){}return t.prototype.buildWorld=function(t){var n=new e(t);return n.setFloors(4),n.build(),n},t}),define("Collider",[],function(){function e(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r}return e}),define("CollisionMap",["Collider"],function(e){function t(){this.collisions=[]}return t.prototype.add=function(e){return this.collisions.push(e),this},t.prototype.clear=function(){return this.collisions=[],this},t}),define("Game",["Loader","Renderer","CreatureFactory","EntityFactory","Input","ScreenMain","MainMenu","WorldFactory","CollisionMap"],function(e,t,n,r,i,s,o,u,a){function f(){var o=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=o,this.paused=!1,this.loaded=!1,this.entities=[],this.input=new i,this.ef=new r,this.cf=new n,this.wf=new u,this.cm=new a,this.loader=new e,this.renderer=new t(document.getElementById("viewport"),960,640),this.loader.add("/assets/sprites/player-test.png"),this.loader.add("/assets/sprites/projectile-test.png"),this.loader.add("/assets/tiles/test.png"),this.loader.add("/assets/sprites/poop-test.png"),this.loader.add("/assets/sprites/fire-test.png"),this.loader.loadAll(),this.renderer.useScreen(new s),this.world=this.wf.buildWorld([this.loader.assets["/assets/tiles/test.png"]]),this.player=this.cf.spawnPlayer(this.loader.assets["/assets/sprites/player-test.png"]),this.entities.push(this.player);var f=this.ef.spawnPoop(this.loader.assets["/assets/sprites/poop-test.png"],this.renderer.canvas.width/2,this.renderer.canvas.height/2);this.entities.push(f);var l=this.ef.spawnFire(this.loader.assets["/assets/sprites/fire-test.png"],this.renderer.canvas.width/4,this.renderer.canvas.height/2);this.entities.push(l),this.loop()}return f.prototype.update=function(){if(!this.loader.checkLoaded())return;this.handleKeys();if(this.paused)return;this.entities.forEach(function(e){e.update()}),this.renderer.update()},f.prototype.draw=function(){if(!this.loader.checkLoaded()||this.paused)return;this.renderer.draw(),this.world.room.draw(this.renderer.ctx);var e=this;this.entities.forEach(function(t){(t.pos.x<0||t.pos.y<0||t.pos.x>e.renderer.canvas.width||t.pos.y>e.renderer.canvas.height)&&e.entities.splice(e.entities.indexOf(t),1),t.draw(e.renderer)})},f.prototype.loop=function(){this.update(),this.draw(),window.requestAnimationFrame(this.loop.bind(this))},f.prototype.handleKeys=function(){this.input.isPressed(77)?(this.paused=!0,this.renderer.useSubscreen(new o),this.renderer.draw()):this.input.isPressed(27)?(this.paused=!1,this.renderer.clearSubscreen()):this.input.isPressed(80)&&(this.renderer.pause(),this.paused=!0);var e={x:0,y:0};this.paused||(this.input.isPressed(87)&&(this.player.move(0,-1),e.y=-1),this.input.isPressed(83)&&(this.player.move(0,1),e.y=1),this.input.isPressed(65)&&(this.player.move(-1,0),e.x=-1),this.input.isPressed(68)&&(this.player.move(1,0),e.x=1),this.input.isPressed(38)&&(this.player.hasFired||(this.entities.push(this.ef.spawnProjectile(this.loader.assets["/assets/sprites/projectile-test.png"],this.player.pos.x,this.player.pos.y,0,-1,e)),this.player.hasFired=!0)),this.input.isPressed(40)&&(this.player.hasFired||(this.entities.push(this.ef.spawnProjectile(this.loader.assets["/assets/sprites/projectile-test.png"],this.player.pos.x,this.player.pos.y,0,1,e)),this.player.hasFired=!0)),this.input.isPressed(37)&&(this.player.hasFired||(this.entities.push(this.ef.spawnProjectile(this.loader.assets["/assets/sprites/projectile-test.png"],this.player.pos.x,this.player.pos.y,-1,0,e)),this.player.hasFired=!0)),this.input.isPressed(39)&&(this.player.hasFired||(this.entities.push(this.ef.spawnProjectile(this.loader.assets["/assets/sprites/projectile-test.png"],this.player.pos.x,this.player.pos.y,1,0,e)),this.player.hasFired=!0)))},f}),require(["Game"],function(e){(function(){function t(){var t=new e}t()})()}),define("main",function(){});